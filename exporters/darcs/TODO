more intelligent tests, such as detect if the hg fastimport extension is
not enabled, etc.

parse the patches manually so we can avoid re-adding existing files manually.

avoid darcs apply.
